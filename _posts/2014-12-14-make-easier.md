---
layout: post
title:  "Упрощение блога на Drupal"
date: 2014-12-14 17:47:00 -0000
tags: blog
description: "Упрощать, после того, как чтото усложнил может быть непросто. Я завёл многопользовательскую систему управления сайтом, добавил в неё плагины и свои настройки. Когда я захотел сделать всё проще - плагина &#8222;сделать просто&#8220; не оказалось. Пришлось делать всё руками."
---

Когда-то я переехал с Wordpress на Drupal и это было очевидной теперь ошибкой. Мне просто не нужны возможности Drupal. Я завёл модуль для групповых блогов и вёл им блог, но это глупость. Мой блог персональный и ему уж точно не грозит стать общей блог-платформой. Завёл модуль для ведения иерархических записей - фактически книг. Но несколько однотипных записей достаточно связать ссылками между собой или сделать страницу - оглавление или присовить им общий тег. 

Теперь у меня возникли проблемы с переездом на новую версию Друпал - 8ю из-за пользовательских типов оформления страницы и специфических модулей. Решение очевидно, последнюю неделю я упрощаю и упрощаю сайт. Нет никакого универсального инструмента для этого, приходится перекраивать базу данных SQL-запросами с постоянным риском вызвать ещё более серъёзные проблемы в движке сайта. Причём решить их можно будет только восстановив сайт целиком из резервной копии. Надеюсь, это не потребуется.

Кратко опишу, что мне пришлось сделать. Сперва я избавился от пользовательского текстового фильтра "Filtred HTML". Я не уверен, но кажется, что он вызывает проблемы при импорте. Так как блог веду я один и нет смысла ограничивать себя в применяемых HTML тегах я переделал тип фильтра всех записей в "Full HTML". Для этого пришлось править таблицу `field_data_body'field_data_body`. В таблице `filter format` я подсмотрел коды разных форматов. 

- Full HTML - 3
- Filtred HTML - 1

Дальше SQL-запросом я заменил все фильтры `Filtred HTML` в `Full HTML`

```sql
UPDATE field_data_body SET body_format = 3 WHERE format = 1
```

Дальше я превратил все материалы типа "blog" в материалы "story". Для этого пришлось править две таблицы:

```sql
UPDATE field_data_body SET 'bundle' = "story" WHERE 'bundle' = "blog"
UPDATE node SET 'type' = "story" WHERE 'type' = "blog"
```

Возможно я пропустил ещё какие-то правки. Но страницы отображаются правильно, как истории, ошибки не выскакивают. Вскоре опять попробую обновиться на новый Друпал. 

Параллельно прочитал свой блог десять лет назад. И опять возникло ощущение, что это не я. Тот, кто писал в блог правил статьи в Википедии и изучал Линукс. Куда больше чем сейчас интересовался политикой и не спал по ночам. С тех пор я жил в пяти новых городах, сменил множество работ, дважды женился и не узнаю себя старого.